<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>P_CountryDataResource.java</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<style type="text/css">
<!--
body {color: #000000; background-color: #ffffff; font-family: Monospaced}
pre {color: #000000; background-color: #ffffff; font-family: Monospaced}
table {color: #000000; background-color: #e9e8e2; font-family: Monospaced}
.ST0 {color: #969696; font-family: Monospaced; font-weight: bold}
.comment {color: #969696}
.line-number {background-color: #e9e8e2}
.ST1 {color: #ce7b00; font-family: Monospaced; font-weight: bold}
.character {color: #ce7b00}
.keyword-directive {color: #0000e6}
-->
</style>
</head>
<body>
<table width="100%"><tr><td align="center">C:\Users\wb385924\Documents\NetBeansProjects\ClimateWeb\src\java\resources\v1\P_CountryDataResource.java</td></tr></table>
<pre>
<span class="line-number">  1</span> <span class="comment">/*</span>
<span class="line-number">  2</span> <span class="comment"> * To change this template, choose Tools | Templates</span>
<span class="line-number">  3</span> <span class="comment"> * and open the template in the editor.</span>
<span class="line-number">  4</span> <span class="comment"> */</span>
<span class="line-number">  5</span> <span class="keyword-directive">package</span> resources.v1;
<span class="line-number">  6</span> 
<span class="line-number">  7</span> <span class="keyword-directive">import</span> com.google.gson.Gson;
<span class="line-number">  8</span> <span class="keyword-directive">import</span> com.sun.jersey.spi.resource.Singleton;
<span class="line-number">  9</span> <span class="keyword-directive">import</span> java.util.HashMap;
<span class="line-number"> 10</span> 
<span class="line-number"> 11</span> <span class="keyword-directive">import</span> java.util.logging.Logger;
<span class="line-number"> 12</span> <span class="keyword-directive">import</span> javax.ws.rs.GET;
<span class="line-number"> 13</span> <span class="keyword-directive">import</span> javax.ws.rs.Path;
<span class="line-number"> 14</span> <span class="keyword-directive">import</span> javax.ws.rs.PathParam;
<span class="line-number"> 15</span> <span class="keyword-directive">import</span> javax.ws.rs.Produces;
<span class="line-number"> 16</span> <span class="keyword-directive">import</span> javax.ws.rs.core.MediaType;
<span class="line-number"> 17</span> <span class="keyword-directive">import</span> javax.ws.rs.core.Response;
<span class="line-number"> 18</span> <span class="keyword-directive">import</span> util.ResponseConstants;
<span class="line-number"> 19</span> <span class="keyword-directive">import</span> service.CountryService;
<span class="line-number"> 20</span> <span class="keyword-directive">import</span> service.DerivedStatsService;
<span class="line-number"> 21</span> <span class="keyword-directive">import</span> service.WebService;
<span class="line-number"> 22</span> <span class="keyword-directive">imp</span><span class="keyword-directive">ort</span> shapefileloader.gcm.P_GcmConfig;
<span class="line-number"> 23</span> <span class="keyword-directive">import</span> shapefileloader.gcm.P_GcmConfigAreaDao;
<span class="line-number"> 24</span> <span class="keyword-directive">import</span> shapefileloader.gcm.P_GcmStatsProperties;
<span class="line-number"> 25</span> <span class="keyword-directive">import</span> util.RequestUtil;
<span class="line-number"> 26</span> <span class="keyword-directive">import</span> service.WebService.Delivery;
<span class="line-number"> 27</span> 
<span class="line-number"> 28</span> <span class="comment">/**</span>
<span class="line-number"> 29</span> <span class="comment"> *</span>
<span class="line-number"> 30</span> <span class="comment"> * </span><span class="ST0">@author</span> <span class="comment">wb385924</span>
<span class="line-number"> 31</span>  <span class="comment">*/</span>
<span class="line-number"> 32</span> @Singleton
<span class="line-number"> 33</span> @Path(<span class="character">&quot;</span><span class="character">/v1/country</span><span class="character">&quot;</span>)
<span class="line-number"> 34</span> <span class="keyword-directive">public</span> <span class="keyword-directive">class</span> P_CountryDataResource {
<span class="line-number"> 35</span> 
<span class="line-number"> 36</span>     <span class="keyword-directive">private</span> <span class="keyword-directive">static</span> <span class="keyword-directive">final</span> Logger log = Logger.getLogger(P_CountryDataResource.<span class="keyword-directive">class</span>.getName());
<span class="line-number"> 37</span> 
<span class="line-number"> 38</span>     @GET
<span class="line-number"> 39</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{longitude},{latitude}</span><span class="character">&quot;</span>)
<span class="line-number"> 40</span>     @Produces(MediaType.APPLICATION_JSON)
<span class="line-number"> 41</span>     <span class="keyword-directive">public</span> String getMonthlyData(
<span class="line-number"> 42</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number"> 43</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number"> 44</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number"> 45</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number"> 46</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number"> 47</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number"> 48</span>             @PathParam(<span class="character">&quot;</span><span class="character">latitude</span><span class="character">&quot;</span>) <span class="keyword-directive">double</span> latitude,
<span class="line-number"> 49</span>             @PathParam(<span class="character">&quot;</span><span class="character">longitude</span><span class="character">&quot;</span>) <span class="keyword-directive">double</span> longitude) {
<span class="line-number"> 50</span>             log.info(<span class="character">&quot;</span><span class="character">getting lat lon data</span><span class="character">&quot;</span>);
<span class="line-number"> 51</span>         <span class="keyword-directive">int</span> countryId = DerivedStatsService.get().getCountryId(latitude, longitude);
<span class="line-number"> 52</span>         P_GcmStatsProperties ds = P_GcmStatsProperties.getInstance();
<span class="line-number"> 53</span> 
<span class="line-number"> 54</span>         P_GcmStatsProperties.climatestat stat = ds.getClimateStat(statName);
<span class="line-number"> 55</span>         P_GcmStatsProperties.gcm gcm = ds.getGcm(gcmName);
<span class="line-number"> 56</span>         P_GcmStatsProperties.scenario scenario = ds.getScenario(scenarioName);
<span class="line-number"> 57</span> 
<span class="line-number"> 58</span>         P_GcmConfig config = <span class="keyword-directive">new</span> P_GcmConfig(WebService.get().getStatType(tempagg), gcm, scenario, stat, fyear, tyear);
<span class="line-number"> 59</span>         <span class="keyword-directive">if</span> (!config.isCompleteIgnoringAreaValueMonth()) {
<span class="line-number"> 60</span>             <span class="keyword-directive">return</span> ResponseConstants.INVALID_PARAMS;
<span class="line-number"> 61</span>         }
<span class="line-number"> 62</span>         config.setAreaId(countryId);
<span class="line-number"> 63</span> 
<span class="line-number"> 64</span>         HashMap&lt;Integer, Double&gt; data = P_GcmConfigAreaDao.get().getAreaDataForTime(config, WebService.get().isAnnual(tempagg));
<span class="line-number"> 65</span>         Gson gson = <span class="keyword-directive">new</span> Gson();
<span class="line-number"> 66</span>         <span class="keyword-directive">return</span> gson.toJson(data);
<span class="line-number"> 67</span> 
<span class="line-number"> 68</span>     }
<span class="line-number"> 69</span> 
<span class="line-number"> 70</span>     <span class="comment">// ================= gcm scneario all vars =======</span><span class="comment">================</span>
<span class="line-number"> 71</span>     @GET
<span class="line-number"> 72</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/{scenario:(?i)(20c3m|a2|b1)}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number"> 73</span>     <span class="keyword-directive">public</span> Response getGcmScenarioAllVars(
<span class="line-number"> 74</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number"> 75</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number"> 76</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number"> 77</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number"> 78</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number"> 79</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number"> 80</span> 
<span class="line-number"> 81</span>         log.info(<span class="character">&quot;</span><span class="character">getting gcm scenario all vars</span><span class="character">&quot;</span>);
<span class="line-number"> 82</span> 
<span class="line-number"> 83</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number"> 84</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number"> 85</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number"> 86</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number"> 87</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number"> 88</span>         }
<span class="line-number"> 89</span> 
<span class="line-number"> 90</span>         <span class="keyword-directive">return</span> WebService.get().getGcmScenarioAllVariables(gcmName, scenarioName,  fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg),mediaType, Delivery.WEB);
<span class="line-number"> 91</span>     }
<span class="line-number"> 92</span> 
<span class="line-number"> 93</span>      <span class="comment">// ================= download gcm scneario all vars =======================</span>
<span class="line-number"> 94</span>     @GET
<span class="line-number"> 95</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/{gcm:</span><span class="ST1">\</span><span class="ST1">\</span><span class="character">w{8,15}}/{scenario:(?i)(20c3m|a2|b1)}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number"> 96</span>     <span class="keyword-directive">public</span> Response downloadGcmScenarioAllVars(
<span class="line-number"> 97</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number"> 98</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number"> 99</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">100</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">101</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">102</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">103</span> 
<span class="line-number">104</span>         log.info(<span class="character">&quot;</span><span class="character">getting gcm scenario all vars</span><span class="character">&quot;</span>);
<span class="line-number">105</span> 
<span class="line-number">106</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">107</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">108</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">109</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">110</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">111</span>         }
<span class="line-number">112</span> 
<span class="line-number">113</span>         <span class="keyword-directive">return</span> WebService.get().getGcmScenarioAllVariables(gcmName, scenarioName,  fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg),mediaType, Delivery.DOWNLOAD);
<span class="line-number">114</span>     }
<span class="line-number">115</span> 
<span class="line-number">116</span>  <span class="comment">// ================= gcm all vars =======================</span>
<span class="line-number">117</span>     @GET
<span class="line-number">118</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/{fyear}/{tyear}</span><span class="character">/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">119</span>     <span class="keyword-directive">public</span> Response getGcmAllVars(
<span class="line-number">120</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">121</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">122</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">123</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">124</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">125</span> 
<span class="line-number">126</span>         log.info(<span class="character">&quot;</span><span class="character">getting gcm scenario all vars</span><span class="character">&quot;</span>);
<span class="line-number">127</span> 
<span class="line-number">128</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">129</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">130</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">131</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">132</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">133</span>         }
<span class="line-number">134</span> 
<span class="line-number">135</span>         <span class="keyword-directive">return</span> WebService.get().getGcmAllVariables(gcmName,   fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg),mediaType, Delivery.WEB);
<span class="line-number">136</span>     }
<span class="line-number">137</span> 
<span class="line-number">138</span>     <span class="comment">// ================= download gcm all vars =======================</span>
<span class="line-number">139</span>     @GET
<span class="line-number">140</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/</span><span class="character">{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">141</span>     <span class="keyword-directive">public</span> Response downloadGcmAllVars(
<span class="line-number">142</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">143</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">144</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">145</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">146</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">147</span> 
<span class="line-number">148</span>         log.info(<span class="character">&quot;</span><span class="character">getting gcm scenario all vars</span><span class="character">&quot;</span>);
<span class="line-number">149</span> 
<span class="line-number">150</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">151</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">152</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">153</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">154</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">155</span>         }
<span class="line-number">156</span> 
<span class="line-number">157</span>         <span class="keyword-directive">return</span> WebService.get().getGcmAllVariables(gcmName,   fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg),mediaType, Delivery.DOWNLOAD);
<span class="line-number">158</span>     }
<span class="line-number">159</span> 
<span class="line-number">160</span> 
<span class="line-number">161</span> 
<span class="line-number">162</span>     <span class="comment">// ================= gcm and scenario single var =======================</span>
<span class="line-number">163</span>     @GET
<span class="line-number">164</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{8,</span><span class="character">15}}/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">165</span>     <span class="keyword-directive">public</span> Response getGcmScenario(
<span class="line-number">166</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">167</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">168</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">169</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">170</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">171</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">172</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">173</span> 
<span class="line-number">174</span>         log.info(<span class="character">&quot;</span><span class="character">getting gcm scenario</span><span class="character">&quot;</span>);
<span class="line-number">175</span> 
<span class="line-number">176</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">177</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">178</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">179</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">180</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">181</span>         }
<span class="line-number">182</span> 
<span class="line-number">183</span>         <span class="keyword-directive">return</span> WebService.get().getGcmScenario(gcmName, scenarioName, statName, fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg),mediaType, Delivery.WEB);
<span class="line-number">184</span>     }
<span class="line-number">185</span> 
<span class="line-number">186</span>     <span class="comment">// =================  download gcm and scenario single var =======================</span>
<span class="line-number">187</span>     @GET
<span class="line-number">188</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/</span><span class="character">{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">189</span>     <span class="keyword-directive">public</span> Response downloadGcmScenario(
<span class="line-number">190</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">191</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">192</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">193</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">194</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">195</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">196</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">197</span> 
<span class="line-number">198</span> 
<span class="line-number">199</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">200</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">201</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">202</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">203</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">204</span>         }
<span class="line-number">205</span> 
<span class="line-number">206</span>         <span class="keyword-directive">return</span> WebService.get().getGcmScenario(gcmName, scenarioName, statName, fyear, tyear, countryId ,WebService.get().getStatType(tempagg), WebService.get().geTempAgg(iso3),mediaType, Delivery.DOWNLOAD);
<span class="line-number">207</span>     }
<span class="line-number">208</span> 
<span class="line-number">209</span> 
<span class="line-number">210</span> 
<span class="line-number">211</span> 
<span class="line-number">212</span>      <span class="comment">// ===================== scenario single var  ============================//</span>
<span class="line-number">213</span>     @GET
<span class="line-number">214</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{scen</span><span class="character">ario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">215</span>     <span class="keyword-directive">public</span> Response getScenarioData(
<span class="line-number">216</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">217</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">218</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">219</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">220</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">221</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">222</span>             log.info(<span class="character">&quot;</span><span class="character">getting single scenario </span><span class="character">&quot;</span>);
<span class="line-number">223</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">224</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">225</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">226</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">227</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">228</span>         }
<span class="line-number">229</span> 
<span class="line-number">230</span>         <span class="keyword-directive">return</span> WebService.get().getSingleScenarioData(scenarioName, statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, WebService.Delivery.WEB);<span class="comment">//getScenarioDataDelegate(scenarioName, statName, fyear, tyear, iso3, mediaType);</span>
<span class="line-number">231</span>     }
<span class="line-number">232</span> 
<span class="line-number">233</span> 
<span class="line-number">234</span>     <span class="comment">// ===================== download scenario single var ============================//</span>
<span class="line-number">235</span>     @GET
<span class="line-number">236</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempag</span><span class="character">g}/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">237</span>     <span class="keyword-directive">public</span> Response downloadScenarioData(
<span class="line-number">238</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">239</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">240</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">241</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">242</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">243</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">244</span> 
<span class="line-number">245</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">246</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">247</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">248</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">249</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">250</span>         }
<span class="line-number">251</span> 
<span class="line-number">252</span>         <span class="keyword-directive">return</span> WebService.get().getSingleScenarioData(scenarioName, statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, WebService.Delivery.DOWNLOAD);<span class="comment">//getScenarioDataDelegate(scenarioName, statName, fyear, tyear, iso3, mediaType);</span>
<span class="line-number">253</span>     }
<span class="line-number">254</span> 
<span class="line-number">255</span> 
<span class="line-number">256</span>      <span class="comment">// ===================== model single var   ============================//</span>
<span class="line-number">257</span>     @GET
<span class="line-number">258</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{gcm:</span><span class="ST1">\\</span><span class="character">w{</span><span class="character">8,15}}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">259</span>     <span class="keyword-directive">public</span> Response getGcmData(
<span class="line-number">260</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">261</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">262</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">263</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">264</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">265</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">266</span>             log.info(<span class="character">&quot;</span><span class="character">getting single gcm</span><span class="character">&quot;</span>);
<span class="line-number">267</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">268</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">269</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">270</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">271</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">272</span>         }
<span class="line-number">273</span> 
<span class="line-number">274</span>         <span class="keyword-directive">return</span> WebService.get().getSingleGcmData(gcmName,statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, WebService.Delivery.WEB);<span class="comment">//getScenarioDataDelegate(scenarioName, statName, fyear, tyear, iso3, mediaType);</span>
<span class="line-number">275</span>     }
<span class="line-number">276</span> 
<span class="line-number">277</span> 
<span class="line-number">278</span>     <span class="comment">// ===================== download model single var ============================//</span>
<span class="line-number">279</span>     @GET
<span class="line-number">280</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/</span><span class="character">{gcm:</span><span class="ST1">\\</span><span class="character">w{8,15}}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">281</span>     <span class="keyword-directive">public</span> Response downloadGcmData(
<span class="line-number">282</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">283</span>             @PathParam(<span class="character">&quot;</span><span class="character">gcm</span><span class="character">&quot;</span>) String gcmName,
<span class="line-number">284</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">285</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">286</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">287</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">288</span> 
<span class="line-number">289</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">290</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">291</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">292</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">293</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">294</span>         }
<span class="line-number">295</span> 
<span class="line-number">296</span>         <span class="keyword-directive">return</span> WebService.get().getSingleGcmData(gcmName, statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, WebService.Delivery.DOWNLOAD);<span class="comment">//getScenarioDataDelegate(scenarioName, statName, fyear, tyear, iso3, mediaType);</span>
<span class="line-number">297</span>     }
<span class="line-number">298</span> 
<span class="line-number">299</span>     <span class="comment">// =================  ensemble scenario percentile var =============================</span>
<span class="line-number">300</span>     @GET
<span class="line-number">301</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/e</span><span class="character">nsemble/{scenario:(?i)(20c3m|a2|b1)}/{percentile}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">302</span>     <span class="keyword-directive">public</span> Response getEnsembleScenario(
<span class="line-number">303</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">304</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">305</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">306</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">307</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">308</span>             @PathParam(<span class="character">&quot;</span><span class="character">percentile</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> percentile,
<span class="line-number">309</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">310</span>             log.info(<span class="character">&quot;</span><span class="character">getting</span><span class="character"> ensemble scenario percentile</span><span class="character">&quot;</span>);
<span class="line-number">311</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">312</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">313</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">314</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">315</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">316</span>         }
<span class="line-number">317</span> 
<span class="line-number">318</span>         <span class="keyword-directive">return</span> WebService.get().getEnsembleScenario(scenarioName, statName, fyear, tyear, percentile, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">319</span>     }
<span class="line-number">320</span> 
<span class="line-number">321</span>     <span class="comment">// ================= download ensemble scenario percentile var =============================</span>
<span class="line-number">322</span>     @GET
<span class="line-number">323</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/</span><span class="character">{tempagg}/ensemble/{scenario:(?i)(20c3m|a2|b1)}/{percentile}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">324</span>     <span class="keyword-directive">public</span> Response downloadEnsembleScenario(
<span class="line-number">325</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">326</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">327</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">328</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">329</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">330</span>             @PathParam(<span class="character">&quot;</span><span class="character">percentile</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> percentile,
<span class="line-number">331</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">332</span> 
<span class="line-number">333</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">334</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">335</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">336</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">337</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">338</span>         }
<span class="line-number">339</span> 
<span class="line-number">340</span>         <span class="keyword-directive">return</span> WebService.get().getEnsembleScenario(scenarioName, statName, fyear, tyear, percentile, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">341</span>     }
<span class="line-number">342</span> 
<span class="line-number">343</span> 
<span class="line-number">344</span>      <span class="comment">// =================  ensemble single scenario all percentile =============================</span>
<span class="line-number">345</span>     @GET
<span class="line-number">346</span>     @Path(<span class="character">&quot;</span><span class="character">/{t</span><span class="character">empagg}/ensemble/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">347</span>     <span class="keyword-directive">public</span> Response getSingleScenarioAllPercentile(
<span class="line-number">348</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">349</span>             @PathParam(<span class="character">&quot;</span><span class="character">sc</span><span class="character">enario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">350</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">351</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">352</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">353</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">354</span>             log.info(<span class="character">&quot;</span><span class="character">getting single scenario all percentile</span><span class="character">&quot;</span>);
<span class="line-number">355</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">356</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">357</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">358</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">359</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">360</span>         }
<span class="line-number">361</span> 
<span class="line-number">362</span>         <span class="keyword-directive">return</span> WebService.get().getSingleScenarioAllPercentile(scenarioName, statName,fyear,tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">363</span>     }
<span class="line-number">364</span> 
<span class="line-number">365</span>     <span class="comment">// =================  download ensemble single scenario all percentile =============================</span>
<span class="line-number">366</span>     @GET
<span class="line-number">367</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/ensemble/{scenario:(?i)(20c3m|a2|b1)}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">368</span>     <span class="keyword-directive">public</span> Response downloadSingleScenarioAllPercentile(
<span class="line-number">369</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">370</span>             @PathParam(<span class="character">&quot;</span><span class="character">scenario</span><span class="character">&quot;</span>) String scenarioName,
<span class="line-number">371</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">372</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">373</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">374</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">375</span> 
<span class="line-number">376</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">377</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">378</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">379</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">380</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">381</span>         }
<span class="line-number">382</span> 
<span class="line-number">383</span>         <span class="keyword-directive">return</span> WebService.get().getSingleScenarioAllPercentile(scenarioName, statName,fyear,tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">384</span>     }
<span class="line-number">385</span> 
<span class="line-number">386</span> 
<span class="line-number">387</span> 
<span class="line-number">388</span>      <span class="comment">// =================  get ensemble single percentile all scenario =============================</span>
<span class="line-number">389</span>     @GET
<span class="line-number">390</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/ensemble/{percentile:</span><span class="ST1">\\</span><span class="character">d{2}}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">391</span>     <span class="keyword-directive">public</span> Response getSinglePercentileAllScenario(
<span class="line-number">392</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">393</span>             @PathParam(<span class="character">&quot;</span><span class="character">st</span><span class="character">at</span><span class="character">&quot;</span>) String statName,
<span class="line-number">394</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">395</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">396</span>             @PathParam(<span class="character">&quot;</span><span class="character">percentile</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> percentile,
<span class="line-number">397</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">398</span>             log.info(<span class="character">&quot;</span><span class="character">getting ensemble single percentile all scenario</span><span class="character">&quot;</span>);
<span class="line-number">399</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">400</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">401</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">402</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">403</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">404</span>         }
<span class="line-number">405</span> 
<span class="line-number">406</span>         <span class="keyword-directive">return</span> WebService.get().getSinglePercentileAllScenario(percentile, statName,fyear,tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">407</span>     }
<span class="line-number">408</span> 
<span class="line-number">409</span>     <span class="comment">// =================  download ensemble single percentile all scenario =============================</span>
<span class="line-number">410</span>     @GET
<span class="line-number">411</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/ensemble/{percentile:</span><span class="ST1">\\</span><span class="character">d{2}}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">412</span>     <span class="keyword-directive">public</span> Response downloadSinglePercentileAllScenario(
<span class="line-number">413</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">414</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">415</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">416</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">417</span>             @PathParam(<span class="character">&quot;</span><span class="character">percentile</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> percentile,
<span class="line-number">418</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">419</span> 
<span class="line-number">420</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">421</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">422</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">423</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">424</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">425</span>         }
<span class="line-number">426</span> 
<span class="line-number">427</span>         <span class="keyword-directive">return</span> WebService.get().getSinglePercentileAllScenario(percentile, statName,fyear,tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">428</span>     }
<span class="line-number">429</span> 
<span class="line-number">430</span> 
<span class="line-number">431</span>     <span class="comment">// =================  ensemble all scenario all percentile  =============================</span>
<span class="line-number">432</span>     @GET
<span class="line-number">433</span>     @Path(<span class="character">&quot;</span><span class="character">/{temp</span><span class="character">agg}/ensemble/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">434</span>     <span class="keyword-directive">public</span> Response getAllScenarioEnsemble(
<span class="line-number">435</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">436</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">437</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">438</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">439</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">440</span> 
<span class="line-number">441</span>         log.fine(<span class="character">&quot;</span><span class="character">getting ensemble all scenario all percentile</span><span class="character">&quot;</span>);
<span class="line-number">442</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">443</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">444</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">445</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">446</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">447</span>         }
<span class="line-number">448</span>         <span class="keyword-directive">return</span> WebService.get().getAllScenarioEnsemble(statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">449</span>     }
<span class="line-number">450</span> 
<span class="line-number">451</span>      <span class="comment">// =================  download ensemble all scenario all percentile =============================</span>
<span class="line-number">452</span> 
<span class="line-number">453</span>     @GET
<span class="line-number">454</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/ensemble/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">455</span>     <span class="keyword-directive">public</span> Response downloadAllScenarioEnsemble(
<span class="line-number">456</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">457</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">458</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">459</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">460</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">461</span> 
<span class="line-number">462</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">463</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">464</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">465</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">466</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">467</span>         }
<span class="line-number">468</span> 
<span class="line-number">469</span>         <span class="keyword-directive">return</span> WebService.get().getAllScenarioEnsemble(statName, fyear, tyear,  countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">470</span> 
<span class="line-number">471</span>     }
<span class="line-number">472</span> 
<span class="line-number">473</span> 
<span class="line-number">474</span>      <span class="comment">// ===============  variable projections  ==================</span>
<span class="line-number">475</span>     @GET
<span class="line-number">476</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{stat}/projection/{iso</span><span class="character">3}</span><span class="character">&quot;</span>)
<span class="line-number">477</span>     <span class="keyword-directive">public</span> Response getGcmProjections(
<span class="line-number">478</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">479</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">480</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">481</span>             log.info(<span class="character">&quot;</span><span class="character">getting all projections</span><span class="character">&quot;</span>);
<span class="line-number">482</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">483</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">484</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">485</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">486</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">487</span>         }
<span class="line-number">488</span> 
<span class="line-number">489</span> 
<span class="line-number">490</span>         <span class="keyword-directive">return</span> WebService.get().getGcmProjections(statName, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">491</span>     }
<span class="line-number">492</span>      <span class="comment">// ===============  download variable projections  ==================</span>
<span class="line-number">493</span>     @GET
<span class="line-number">494</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/{stat}/projec</span><span class="character">tion/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">495</span>     <span class="keyword-directive">public</span> Response downloadGcmProjections(
<span class="line-number">496</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">497</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">498</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">499</span>             log.info(<span class="character">&quot;</span><span class="character">getting all projections</span><span class="character">&quot;</span>);
<span class="line-number">500</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">501</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">502</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">503</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">504</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">505</span>         }
<span class="line-number">506</span> 
<span class="line-number">507</span> 
<span class="line-number">508</span>         <span class="keyword-directive">return</span> WebService.get().getGcmProjections(statName, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">509</span>     }
<span class="line-number">510</span> 
<span class="line-number">511</span> 
<span class="line-number">512</span>      <span class="comment">// ===============  ensemble projections  ==================</span>
<span class="line-number">513</span>     @GET
<span class="line-number">514</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/ensemble/{stat}/project</span><span class="character">ion/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">515</span>     <span class="keyword-directive">public</span> Response getEnsembleProjections(
<span class="line-number">516</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">517</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">518</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">519</span>             log.info(<span class="character">&quot;</span><span class="character">getting all projections</span><span class="character">&quot;</span>);
<span class="line-number">520</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">521</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">522</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">523</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">524</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">525</span>         }
<span class="line-number">526</span> 
<span class="line-number">527</span> 
<span class="line-number">528</span>         <span class="keyword-directive">return</span> WebService.get().getEnsembleProjections(statName, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">529</span>     }
<span class="line-number">530</span> 
<span class="line-number">531</span>       <span class="comment">// ===============  download ensemble projections  ==================</span>
<span class="line-number">532</span>     @GET
<span class="line-number">533</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/ensemble/{s</span><span class="character">tat}/projection/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">534</span>     <span class="keyword-directive">public</span> Response downloadEnsembleProjections(
<span class="line-number">535</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">536</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">537</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">538</span>             log.info(<span class="character">&quot;</span><span class="character">getting all projections</span><span class="character">&quot;</span>);
<span class="line-number">539</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">540</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">541</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">542</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">543</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">544</span>         }
<span class="line-number">545</span> 
<span class="line-number">546</span> 
<span class="line-number">547</span>         <span class="keyword-directive">return</span> WebService.get().getEnsembleProjections(statName, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">548</span>     }
<span class="line-number">549</span>    
<span class="line-number">550</span>     <span class="comment">// ===============  L3  Gcm  ==================</span>
<span class="line-number">551</span>     @GET
<span class="line-number">552</span>     @Path(<span class="character">&quot;</span><span class="character">/{tempagg}/{stat}/{fyear}/{tyear}/{iso3}</span><span class="character">&quot;</span>)
<span class="line-number">553</span>     <span class="keyword-directive">public</span> Response getAllGcmAllScenarioAllGcmMonthlyDataIso(
<span class="line-number">554</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">555</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">556</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">557</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">558</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">559</span>             log.info(<span class="character">&quot;</span><span class="character">getting all gcm a</span><span class="character">ll scenario</span><span class="character">&quot;</span>);
<span class="line-number">560</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">561</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">562</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">563</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">564</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">565</span>         }
<span class="line-number">566</span> 
<span class="line-number">567</span> 
<span class="line-number">568</span>         <span class="keyword-directive">return</span> WebService.get().getAllGcmAllScenario(statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.WEB);
<span class="line-number">569</span>     }
<span class="line-number">570</span> 
<span class="line-number">571</span> 
<span class="line-number">572</span>     <span class="comment">// ========  L3 Gcm Download  ===================  //</span>
<span class="line-number">573</span>     @GET
<span class="line-number">574</span>     @Path(<span class="character">&quot;</span><span class="character">/dl/{tempagg}/{stat}/{fyear}/{tyear}/{iso3</span><span class="character">}</span><span class="character">&quot;</span>)
<span class="line-number">575</span>     <span class="keyword-directive">public</span> Response downloadAllGcmAllScenarioAllGcmMonthlyDataIso(
<span class="line-number">576</span>             @PathParam(<span class="character">&quot;</span><span class="character">tempagg</span><span class="character">&quot;</span>) String tempagg,
<span class="line-number">577</span>             @PathParam(<span class="character">&quot;</span><span class="character">stat</span><span class="character">&quot;</span>) String statName,
<span class="line-number">578</span>             @PathParam(<span class="character">&quot;</span><span class="character">fyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> fyear,
<span class="line-number">579</span>             @PathParam(<span class="character">&quot;</span><span class="character">tyear</span><span class="character">&quot;</span>) <span class="keyword-directive">int</span> tyear,
<span class="line-number">580</span>             @PathParam(<span class="character">&quot;</span><span class="character">iso3</span><span class="character">&quot;</span>) String iso3) {
<span class="line-number">581</span> 
<span class="line-number">582</span>         String mediaType = RequestUtil.getResponseType(iso3);
<span class="line-number">583</span>         iso3 = RequestUtil.getIdentifier(iso3);
<span class="line-number">584</span>         <span class="keyword-directive">int</span> countryId = CountryService.get().getId(iso3);
<span class="line-number">585</span>         <span class="keyword-directive">if</span> (countryId == -1) {
<span class="line-number">586</span>             <span class="keyword-directive">return</span> Response.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();
<span class="line-number">587</span>         }
<span class="line-number">588</span>         Response r = WebService.get().getAllGcmAllScenario(statName, fyear, tyear, countryId, WebService.get().getStatType(tempagg), WebService.get().geTempAgg(tempagg), mediaType, Delivery.DOWNLOAD);
<span class="line-number">589</span>         <span class="keyword-directive">return</span> r;
<span class="line-number">590</span>     }
<span class="line-number">591</span> 
<span class="line-number">592</span>     
<span class="line-number">593</span>    
<span class="line-number">594</span> <span class="comment">//    private Response getScenarioDataDelegate(</span>
<span class="line-number">595</span> <span class="comment">//            String scenarioName,</span>
<span class="line-number">596</span> <span class="comment">//         </span><span class="comment">   String statName,</span>
<span class="line-number">597</span> <span class="comment">//            int fyear,</span>
<span class="line-number">598</span> <span class="comment">//            int tyear,</span>
<span class="line-number">599</span> <span class="comment">//            String iso3, String format) {</span>
<span class="line-number">600</span> <span class="comment">//        int countryId = CountryS</span><span class="comment">ervice.get().getId(iso3);</span>
<span class="line-number">601</span> <span class="comment">//        log.log(Level.INFO, &quot;getting country id is {0}&quot;, countryId);</span>
<span class="line-number">602</span> <span class="comment">//        P_GcmStatsProperties ds = P_GcmStatsProperties.</span><span class="comment">getInstance();</span>
<span class="line-number">603</span> <span class="comment">//        P_GcmStatsProperties.climatestat stat = ds.getClimateStat(statName);</span>
<span class="line-number">604</span> <span class="comment">//        P_GcmStatsProperties.scenario scenario </span><span class="comment">= ds.getScenario(scenarioName);</span>
<span class="line-number">605</span> <span class="comment">//</span>
<span class="line-number">606</span> <span class="comment">//        //@TODO validate the config here</span>
<span class="line-number">607</span> <span class="comment">//        P_GcmConfig config = new P_GcmConfig(P_GcmStatsProperties.stat_type.mean</span><span class="comment">, null, scenario, stat, fyear, tyear);</span>
<span class="line-number">608</span> <span class="comment">//        if (scenario == null || stat == null) {</span>
<span class="line-number">609</span> <span class="comment">//            String errorResponse = DataFormatHelper.formatData(format, Respo</span><span class="comment">nseConstants.INVALID_PARAMS);</span>
<span class="line-number">610</span> <span class="comment">//            return Response.ok(errorResponse, format).build();</span>
<span class="line-number">611</span> <span class="comment">//        }</span>
<span class="line-number">612</span> <span class="comment">//        config.setAreaId(countryId);</span>
<span class="line-number">613</span> <span class="comment">//        Li</span><span class="comment">st&lt;GcmDatum&gt; gcms = P_GcmConfigAreaDao.get().getAllGcmAreaData(config, false);</span>
<span class="line-number">614</span> <span class="comment">//        String formattedData = DataFormatHelper.formatGcms(format, gcms);</span>
<span class="line-number">615</span> <span class="comment">//</span>
<span class="line-number">616</span> <span class="comment">//        Response.ResponseBuilder builder = Resp</span><span class="comment">onse.ok(formattedData, format);</span>
<span class="line-number">617</span> <span class="comment">//        return builder.build();</span>
<span class="line-number">618</span> <span class="comment">//    }</span>
<span class="line-number">619</span> 
<span class="line-number">620</span> 
<span class="line-number">621</span> <span class="comment">//    private Response getAllScenarioEnsembleDelegate( String statName, int fyear, i</span><span class="comment">nt tyear, int percentile, String iso3, String format) {</span>
<span class="line-number">622</span> <span class="comment">//        int countryId = CountryService.get().getId(iso3);</span>
<span class="line-number">623</span> <span class="comment">//        log.log(Level.INFO, &quot;getting country id is {0}&quot;, countryId</span><span class="comment">);</span>
<span class="line-number">624</span> <span class="comment">//        P_GcmStatsProperties ds = P_GcmStatsProperties.getInstance();</span>
<span class="line-number">625</span> <span class="comment">//        P_GcmStatsProperties.climatestat stat = ds.get</span><span class="comment">ClimateStat(statName);</span>
<span class="line-number">626</span> <span class="comment">//</span>
<span class="line-number">627</span> <span class="comment">//        P_EnsembleConfig config = new P_EnsembleConfig(P_GcmStatsProperties.stat_type.mean, null, stat, fyear, tyear, perce</span><span class="comment">ntile);</span>
<span class="line-number">628</span> <span class="comment">//        if (stat == null ) {</span>
<span class="line-number">629</span> <span class="comment">//            String errorResponse = DataFormatHelper.formatData(format, ResponseConstants.INVALI</span><span class="comment">D_PARAMS);</span>
<span class="line-number">630</span> <span class="comment">//            return Response.ok(errorResponse, format).build();</span>
<span class="line-number">631</span> <span class="comment">//        }</span>
<span class="line-number">632</span> <span class="comment">//        config.setAreaId(countryId);</span>
<span class="line-number">633</span> <span class="comment">//        Li</span><span class="comment">st&lt;EnsembleDatum&gt; ensembles =  P_EnsembleConfigAreaDao.get().getAllScenarioAreaDataForTime(config, false);</span>
<span class="line-number">634</span> <span class="comment">//</span>
<span class="line-number">635</span> <span class="comment">//        String formattedData = DataFormatHelper.formatEnsembles(format, ensembles);</span>
<span class="line-number">636</span> <span class="comment">//        Response.ResponseBuilder buil</span><span class="comment">der = Response.ok(formattedData, format);</span>
<span class="line-number">637</span> <span class="comment">//</span>
<span class="line-number">638</span> <span class="comment">//        return builder.build();</span>
<span class="line-number">639</span> <span class="comment">//    }</span>
<span class="line-number">640</span>     
<span class="line-number">641</span>     <span class="comment">// ============  aggregate across all gcms ==================//</span>
<span class="line-number">642</span> <span class="comment">//    @GET</span>
<span class="line-number">643</span> <span class="comment">//    @Path(&quot;/{scenario}/{stat}/{fyear}/{tyear}/{iso3}&quot;)</span>
<span class="line-number">644</span> <span class="comment">//    public Response getAllMonthlyDataIso(</span>
<span class="line-number">645</span> <span class="comment">//            @PathParam(&quot;s</span><span class="comment">cenario&quot;) String scenarioName,</span>
<span class="line-number">646</span> <span class="comment">//            @PathParam(&quot;stat&quot;) String statName,</span>
<span class="line-number">647</span> <span class="comment">//            @PathParam(&quot;fyear&quot;) int fyear,</span>
<span class="line-number">648</span> <span class="comment">//            @PathParam(&quot;tyear&quot;)</span><span class="comment"> int tyear,</span>
<span class="line-number">649</span> <span class="comment">//            @PathParam(&quot;iso3&quot;) String iso3) {</span>
<span class="line-number">650</span> <span class="comment">//</span>
<span class="line-number">651</span> <span class="comment">//        if (iso3 == null || iso3.length() &lt; 3) {</span>
<span class="line-number">652</span> <span class="comment">//            return Respo</span><span class="comment">nse.ok(ResponseConstants.INVALID_ISO, MediaType.APPLICATION_JSON).build();</span>
<span class="line-number">653</span> <span class="comment">//        }</span>
<span class="line-number">654</span> <span class="comment">//        if (iso3 != null &amp;&amp; (iso3.contains(ResponseConstants.xml) || iso3.contains(ResponseConstants.XML))) {</span>
<span class="line-number">655</span> <span class="comment">//  </span><span class="comment">          return getAllMonthlyDataIsoDelegate(scenarioName, statName, fyear, tyear, iso3.substring(0, iso3.indexOf(ResponseConstants.DOT)), MediaType.APPLICATION_XML);</span>
<span class="line-number">656</span> <span class="comment">//        }</span>
<span class="line-number">657</span> <span class="comment">//</span>
<span class="line-number">658</span> <span class="comment">//        return getAllMonthlyDataIsoDelegate(scenarioName, statName, fyear, tyear, iso3, MediaType.APPLICATION_J</span><span class="comment">SON);</span>
<span class="line-number">659</span> <span class="comment">//    }</span>
<span class="line-number">660</span>  
<span class="line-number">661</span> <span class="comment">//    private Response getAllGcmAllScenarioMonthlyDataIsoDelegate(</span>
<span class="line-number">662</span> <span class="comment">//            String statName,</span>
<span class="line-number">663</span> <span class="comment">//            int fy</span><span class="comment">ear,</span>
<span class="line-number">664</span> <span class="comment">//            int tyear,</span>
<span class="line-number">665</span> <span class="comment">//            String iso3, String format, boolean download) {</span>
<span class="line-number">666</span> <span class="comment">//        int countryId = CountryService.</span><span class="comment">get().getId(iso3);</span>
<span class="line-number">667</span> <span class="comment">//        log.log(Level.INFO, &quot;getting country id is {0}&quot;, countryId);</span>
<span class="line-number">668</span> <span class="comment">//        P_GcmStatsProperties ds = P_GcmStatsProperties.</span><span class="comment">getInstance();</span>
<span class="line-number">669</span> <span class="comment">//        P_GcmStatsProperties.climatestat stat = ds.getClimateStat(statName);</span>
<span class="line-number">670</span> <span class="comment">//</span>
<span class="line-number">671</span> <span class="comment">//        //@TODO validate the config here</span>
<span class="line-number">672</span> <span class="comment">// </span><span class="comment">       P_GcmConfig config = new P_GcmConfig(P_GcmStatsProperties.stat_type.mean, null, null, stat, fyear, tyear);</span>
<span class="line-number">673</span> <span class="comment">//        if ( stat == null) {</span>
<span class="line-number">674</span> <span class="comment">//            String errorResponse = DataFormatHelper.formatData(format, ResponseConstants.INVALI</span><span class="comment">D_PARAMS);</span>
<span class="line-number">675</span> <span class="comment">//            return Response.ok(errorResponse, format).build();</span>
<span class="line-number">676</span> <span class="comment">//        }</span>
<span class="line-number">677</span> <span class="comment">//        config.setAreaId(countryId);</span>
<span class="line-number">678</span> <span class="comment">//        Li</span><span class="comment">st&lt;GcmDatum&gt; gcms = P_GcmConfigAreaDao.get().getAllScenarioAllGcmData(config, false);</span>
<span class="line-number">679</span> <span class="comment">//        String formattedData = DataFormatHelper.formatGcms(format, gcms);</span>
<span class="line-number">680</span> <span class="comment">//        Response.ResponseBuilder r = null;</span>
<span class="line-number">681</span> <span class="comment">//     </span><span class="comment">   if(!download){</span>
<span class="line-number">682</span> <span class="comment">//            r =  Response.ok(formattedData, format);</span>
<span class="line-number">683</span> <span class="comment">//        }</span>
<span class="line-number">684</span> <span class="comment">//        else{</span>
<span class="line-number">685</span> <span class="comment">//            r = Response.ok(formattedData, </span><span class="comment">format).header(&quot;Content-Disposition&quot;, &quot;attachement; filename=download.csv&quot;);</span>
<span class="line-number">686</span> <span class="comment">//        }</span>
<span class="line-number">687</span> <span class="comment">//        return r.build();</span>
<span class="line-number">688</span> <span class="comment">//    }</span>
<span class="line-number">689</span> }
<span class="line-number">690</span> 
<span class="line-number">691</span> 
</pre></body>
</html>
